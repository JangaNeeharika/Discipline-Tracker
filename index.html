<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discipline Tracker</title>

<style>
:root {
    --bg: #0f172a;
    --container: #1e293b;
    --text: #ffffff;
    --muted: #111827;
    --primary: #669aed;
    --primary-hover: #2563eb;
    --done: #1e8945;
    --report-grad1: #1e293b;
    --report-grad2: #334155;
}

body.light {
    --bg: #ffffff;
    --container: #ffffff;
    --text: #0d0d0d;
    --muted: #cbd5e1;
    --primary: #2563eb;
    --primary-hover: #1d4ed8;
    --done: #16a34a;
    --report-grad1: #e2e8f0;
    --report-grad2: #cbd5e1;
}

body {
    font-family: Arial, sans-serif;
    background: var(--bg);
    padding: 20px;
    color: var(--text);
    transition: 0.3s ease;
}

.container {
    background: var(--container);
    padding: 20px;
    border-radius: 12px;
    width: 100%;
    max-width: 1400px;
    margin: auto;
}

/* Controls */
.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}

select, input {
    padding: 10px;
    border-radius: 6px;
    border: none;
    background: var(--muted);
    color: var(--text);
    flex: 1;
    min-width: 120px;
}

button {
    padding: 10px;
    border-radius: 6px;
    border: none;
    background: var(--primary);
    color: white;
    cursor: pointer;
    flex: 1;
    min-width: 120px;
}

button:hover {
    background: var(--primary-hover);
}

/* Table */
.table-wrapper {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 6px;
    margin-top: 10px;
    font-size: 13px;
    min-width: 700px;
}

th {
    background: var(--muted);
    padding: 6px;
    font-size: 10px;
}

tbody td:not(:first-child) {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
}

.done {
    background-color: var(--done);
    box-shadow: 0 0 8px rgba(34,197,94,0.6);
}

.not-done {
    background-color: var(--muted);
}

tbody td:first-child {
    border-radius: 8px;
    padding: 6px;
    background: var(--muted);
    position: relative;
    cursor: pointer;
}

/* Popup */
.habit-menu {
    position: absolute;
    top: 35px;
    left: 5px;
    background: var(--container);
    border-radius: 8px;
    padding: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    z-index: 10;
}

.habit-menu button {
    display: block;
    width: 100%;
    margin-bottom: 5px;
    font-size: 12px;
}

/* Report */
.report {
    margin-top: 40px;
    padding: 20px;
    border-radius: 14px;
    background: linear-gradient(135deg, var(--report-grad1), var(--report-grad2));
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    text-align: center;
}

.report div {
    background: rgba(255,255,255,0.05);
    padding: 10px;
    border-radius: 12px;
}

.report p {
    font-size: 22px;
    font-weight: bold;
}

/* Graph */
canvas {
    width: 100%;
    height: 300px;
    margin-top: 30px;
    background: var(--muted);
    border-radius: 12px;
}

/* Mobile Optimization */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }

    .container {
        padding: 15px;
    }

    h1 {
        font-size: 20px;
    }

    button, select, input {
        width: 100%;
    }
}
</style>
</head>

<body>

<div class="container">

<h1 style="text-align:center;">Discipline Tracker</h1>

<div class="controls">
<select id="yearSelect"></select>
<select id="monthSelect"></select>
<input type="text" id="habitInput" placeholder="New habit">
<button type="button" onclick="addHabit()">Add Habit</button>
<button type="button" onclick="toggleTheme()">Toggle Theme</button>
</div>

<div class="table-wrapper">
<table id="habitTable">
<thead>
<tr id="headerRow"><th>Habit</th></tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="report">
<div><h3>üî• Strong Days</h3><p id="strongDays">0</p></div>
<div><h3>‚ö† Weak Days</h3><p id="weakDays">0</p></div>
<div><h3>üìä Completion</h3><p id="completionRate">0%</p></div>
<div><h3>üî• Current Streak</h3><p id="currentStreak">0</p></div>
<div><h3>üèÜ Best Streak</h3><p id="bestStreak">0</p></div>
</div>

<canvas id="monthlyGraph"></canvas>

</div>

<script>
let currentYear = new Date().getFullYear();
let currentMonth = new Date().getMonth();

let habits = JSON.parse(localStorage.getItem("habits")) || ["Wake Early","DSA 60min","Exercise"];
let data = JSON.parse(localStorage.getItem("habitData")) || {};

const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

const canvas = document.getElementById("monthlyGraph");
const ctx = canvas.getContext("2d");

function daysInMonth(year, month){
    return new Date(year, month+1, 0).getDate();
}

function initializeSelectors(){
    const yearSelect = document.getElementById("yearSelect");
    const monthSelect = document.getElementById("monthSelect");

    yearSelect.innerHTML="";
    monthSelect.innerHTML="";

    for(let y=2024; y<=2030; y++){
        let option=document.createElement("option");
        option.value=y;
        option.textContent=y;
        if(y===currentYear) option.selected=true;
        yearSelect.appendChild(option);
    }

    monthNames.forEach((m,i)=>{
        let option=document.createElement("option");
        option.value=i;
        option.textContent=m;
        if(i===currentMonth) option.selected=true;
        monthSelect.appendChild(option);
    });

    yearSelect.addEventListener("change", ()=>{
        currentYear=parseInt(yearSelect.value);
        renderTable();
    });

    monthSelect.addEventListener("change", ()=>{
        currentMonth=parseInt(monthSelect.value);
        renderTable();
    });
}

function initializeData(){
    if(!data[currentYear]) data[currentYear]={};
    if(!data[currentYear][currentMonth]){
        data[currentYear][currentMonth] =
            habits.map(()=>Array(daysInMonth(currentYear,currentMonth)).fill(0));
    }
}

function saveData(){
    localStorage.setItem("habits",JSON.stringify(habits));
    localStorage.setItem("habitData",JSON.stringify(data));
}

function renderTable(){
    initializeData();
    const headerRow=document.getElementById("headerRow");
    const tbody=document.querySelector("#habitTable tbody");

    headerRow.innerHTML="<th>Habit</th>";
    tbody.innerHTML="";
    let totalDays=daysInMonth(currentYear,currentMonth);

    for(let d=1; d<=totalDays; d++){
        let th=document.createElement("th");
        let dateObj=new Date(currentYear,currentMonth,d);
        th.innerHTML=dayNames[dateObj.getDay()]+"<br>"+d;
        headerRow.appendChild(th);
    }

    habits.forEach((habit,r)=>{
        let row=document.createElement("tr");
        let habitCell=document.createElement("td");
        habitCell.textContent = habit;
        row.appendChild(habitCell);

        for(let c=0;c<totalDays;c++){
            let cell=document.createElement("td");
            cell.className=data[currentYear][currentMonth][r][c]?"done":"not-done";
            cell.addEventListener("click",()=>{
                data[currentYear][currentMonth][r][c]^=1;
                saveData();
                renderTable();
            });
            row.appendChild(cell);
        }
        tbody.appendChild(row);
    });

    updateReport();
}

function addHabit(){
    let input=document.getElementById("habitInput");
    let value=input.value.trim();
    if(!value) return;

    habits.push(value);
    data[currentYear][currentMonth].push(
        Array(daysInMonth(currentYear,currentMonth)).fill(0)
    );

    input.value="";
    saveData();
    renderTable();
}

document.getElementById("habitInput").addEventListener("keypress", function(e){
    if(e.key==="Enter"){
        addHabit();
    }
});

function toggleTheme(){
    document.body.classList.toggle("light");
}

function updateReport(){}

initializeSelectors();
renderTable();
</script>

</body>
</html>
